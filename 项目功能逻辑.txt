
项目制作流程码云地址: https://gitee.com/hmgzqd17/wepyshop

使用微信小程序组件化开发框架Wepy: https://tencent.github.io/wepy/


(零).搭建项目
	
      (A)安装wepy:
      		(1).使用wepy小程序开发文档:https://tencent.github.io/wepy/document.html#/
      		(2).全局安装 npm install wepy-cli -g  查看版本 wepy -v
      		(3). npm config get prefix 能查看npm的目录
      		(4). 生成目录(1.7.0+的版本用) wepy init empty wepyshop  此时生成一个wepyshop文件夹,用于开发
      		(5). 在生成的目录下安装依赖 npm i
	   		注意: APPID在https://mp.weixin.qq.com/中
      (B)在vscode中配置:
   		(1)配置当前页:打开安装vetur,配置:右下角=>选择语言模式处改为vue
   		(2)配置全局: 文件-首选项-设置-用户设置-添加自己团队的配置-"*.wpy": "vue"
   		(3)在project.config.json文件中修改自己的APPID
		(4) 以上2步可以直接在该目录下放入.vscode包(里面配置好,推荐,因为配置全面)

      (C) 开启实时编译,在使用中不能关闭,指令: wepy build --watch

      (D)项目跑起来
		(1) 前往微信开发者工具,创建小程序项目管理->打开本目录
		 ..APPID问题:如果在A4步骤生成项目中已填入id,在创建小程序项目时会自动找到该id填充,否则手动填充并需要在project.config.json文件中填入

		
 	  ....总结:所用到的命令:
	 	wepy init empty wepyshop    1. 初始化wepy项目
	 	cd wepyshop                 2. 进入项目文件夹
	 	npm i                       3. 安装 npm 依赖包
	 	wepy build --watch          4. 编译 wepy 项目


配置文件说明:
	(1)prettierrc文件和.editorconfig是配置代码规范用的,计算机会优先使用该规范,需要安装插件EditorConfig和Prettier才能使用
     	  添加配置:prettierrc文件的配置 "singleQuote": true,是否使用单引号   "semi": false

     	(2)添加配置文件.vscode到src同级目录中,.vscode文件的作用:被优先读取该配置,而不读取首选项中的配置,以后团队开发时约定的配置


(一).首页
	(1).flex+rpx布局
	(2).使用轮播图模块


	
(二).商品详情页 (思路:点击某个商品跳转到商品详情页面,发送请求获取数据渲染页面)
     (A).图片预览部分:(一般在商品详情页的轮播图中存在多张图片)
	        (1).注册点击事件,并传入当前被点击图片的键(值一般是数组)
		(2).创建一个空数组AA,将遍历获得预览图片存到数组AA中
		(3).调用图片预览API,将数组AA传给API的url即可

     (B).规格参数部分:
		(1).直接将数据渲染

     (C).图文详情部分:
		(1).使用富文本插件wxParse:将后台返回的html格式的数据解析
			使用:下载=>添加到目录=>导入js和样式=>数据绑定=>在模板中使用
		(2).渲染
		(3).去除富文本出现的警告:加入wxParseImgLoad() {}

     (D).规格参数和图文详情之间的切换
		(0)思路:将图文详情和规格参数传入一个数组,通过遍历这个数组获取索引,根据这个索引index驱动切换
		(1).注册tap事件,并传递index  index表示索引
		(2).根据index,使用hidden属性判断索引值从而进行隐藏和显示,(hidden或解释成display)
		(3).二合一,跟据三元表达式判断索引从而切换样式

     (E).联系客服功能
		(1).根据开发文档教程,在页面中使用 <button open-type="contact" /> 可以显示进入客服会话按钮
		(2).给button定位并设置透明度
		(3).注:登录 mp.weixin.qq.com 微信公众平台小程序后台，添加客服人员; 登录 mpkf.weixin.qq.com 微信公众平台客服系统，回复用户消息; 

     (F).跳转购物车功能:
		(1).注册点击事件
		(2).通过wepy.switchTab跳转到购物车(tabBar页面的跳转方式)

     (G).加入购物车功能
		(1).注册事件
		(2).创建一个对象来保存该商品的信息,并添加选中状态
		(3).获取本地(原有)购物车商品列表数据,并定义一个校验方法,即校验当前商品(id)与购物车原有商品(id)是否重复,如果重复,则直接在数量上++,否则将当前商品追加到原有商品后面进行渲染;(这里先假设购物车中没有当前商品[-1],判断过程中如果有该商品则返回索引,然后根据返回的索引判断,若是-1,则追加,若是其他值则++)
		(4).更新本地储存的购物车列表
		(5).提示

      (H).送至-收货地址
		(1).导入私有收货地址组件=>注册组件=>使用组件
			


(三)购物车页面
      (A).页面基本数据渲染
		(1).在onShow中通过wepy.getStorageSync获取本地购物车商品数据 (onLoad:加载整个项目时只执行一次,onShow:每次页码切换否执行,有利于获取最新数据)
		(2).渲染

      (B).商品数量增减
		(1).加减按钮注册相同点击事件,传递用于区分每条数据的索引index参数和加减号参数
		(2).根据索引进行数量加减
		(3).判断当数量一直减到<1时,弹出模态框提示是否删除商品,确定删除=>根据索引使用数组方法splice()删除该商品;若是取消=>该商品数量重置为1

      (C).表单框自由输入数量
		(1).使用input专属事件注册,传入商品索引值,传入事件对象(第二个参数自动识别)
		(2).获取输入内容,转换成数值形式
		(3).判断输入内容非法,return原来的值,合法,更新到商品数量

      (D).商品选中状态切换
	    (I).单个商品按钮
		(1).注册点击事件,传入商品索引
		(2).通过每次点击,将商品的状态取反实现状态切换
		(3).根据商品状态,使用三元表达式切换图标样式

	    (II).通过计算属性监听购物车商品的变化从而计算记录被选商品的数量
		(1).在data中定义一个记录被选商品数量的变量,并初始化为0
		(2).遍历购物车商品,若商品状态为被选中(true),则商品数量++
		(3).同时可以计算总金额
		(4).切换类:使用三元表打式判断当被选中商品数量===购物车商品数量是动态切换类
	
	    (III).全选返选
		(1).注册事件,传入II中获取的被选中商品数量==购物车商品数量比较(相等为true,不等为false)
		(2).遍历购物车商品, 使每次点击全选返选按钮时,将商品状态取反
		
		
	    (IV).计算:使用navigator跳转到订单页面


(四).确定订单页面(cart_order.wpy)
      (A).收货信息
		(1).使用私有地址组件,值子传父

      (B).获取商品信息渲染列表
		(1).通过onShow函数配合wepy.getStorageSync获取本地储存的购物车商品
		(2).渲染列表,注意只有商品选中状态才能被显示出来
		(3).使用计算属性计算商品总价格

      (C).微信授权登录
		(0).注意wx.getUserInfo接口已被废除,使用button指定开放能力配合bindgetuserinfo获取用户信息
		(1).使用button标签,指定开放能力open-type="getUserInfo"
		(2).给button按钮注册getuserinfo事件,自带event事件对象,通过事件对象获取用户信息并储存到本地实现多页面共享
		(3).通过wepy.login()获取缺少的code
		(4).将所需信息收集,以便换取token
		(5).封装获取token的函数
		(6).获取token后将token存到本地
		(7).当切换到订单页面时获取本地token
	
      (D).请求拦截
		(1).请求拦截由wepy提供,拦截所有请求
		(2).获取本地token,当存在本地token时,将token设置给请求头

      (E).微信支付
		(1).注册点击事件
		(2).判断如果收货地址为空,提示选择收货地址,当收货地址不为空,遍历购物车商品,将选中状态的商品添加到一个数组中BB
		(3).遍历数组BB,将其商品信息收集成对象,并添加到数组中CC,这一步主要是为了用于后台二次校验
		(4).收集收货地址等信息
		(5).将商品信息CC和收货信息一同添加到对象中options
		(6).调用创建订单函数

      (F).发送订单请求
		(1).定义创建订单函数,并发送订单请求,传入options
		(2).从后台返回的数据中获得订单号orderNumber
		(3).调用订单支付函数

      (G).发送订单支付
		(1).创建订单支付函数,传入订单号
		(2).发送请求,获取微信支付对象参数
		(3).调用微信支付接口wepy.requestPayment()=>可以扫码支付了
		(4).后台校验:
			(I).发送校验请求,传入订单号,后天基于订单号进行校验
			(II).校验成功,跳转到订单页面orders
	



(五).上线
	(1).上传完整代码
	(2).登录https://mp.weixin.qq.com/,按流程进行发布
	(3).等待审核通过 0.5-1天







